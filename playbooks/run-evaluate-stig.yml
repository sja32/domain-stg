---
- name: Run Evaluate-STIG with Console + CKL + CSV Export
  hosts: all
  gather_facts: no

  vars:
    stig_version: "Evaluate-STIG_1.2507.5"
    stig_local_path: "C:\\ProgramData\\{{ stig_version }}"
    stig_results_local: "C:\\Users\\Public\\Documents\\STIG_Compliance"

  tasks:

    - name: ▶️ Run Evaluate-STIG (Console Mode + Export CKL + CSV)
      ansible.windows.win_powershell:
        script: |
          Write-Host "Running Evaluate-STIG in Console Mode..."
          & "{{ stig_local_path }}\\Evaluate-STIG.ps1" `
            -Console `
            -Output CKL,CSV `
            -OutputPath "{{ stig_results_local }}"
        error_action: stop
      args:
        executable: PowerShell.exe

    - name: ✅ Completed Scan
      ansible.builtin.debug:
        msg: "STIG scan completed and results exported on {{ inventory_hostname }}"
