---
- name: Run Evaluate-STIG and produce CKL + CSV outputs
  hosts: all
  gather_facts: no

  vars:
    stig_local_path: "{{ stig_local_path | default('C:\\ProgramData\\Evaluate-STIG_1.2507.5') }}"
    stig_results_local: "{{ stig_results_local | default('C:\\Users\\Public\\Documents\\STIG_Compliance') }}"

  tasks:

    - name: ▶️ Run Evaluate-STIG with CKL + CSV export
      ansible.windows.win_powershell:
        script: |
          Write-Host "Running Evaluate-STIG..."
          & "{{ stig_local_path }}\\Evaluate-STIG.ps1" -Output "CKL,CSV" -OutputPath "{{ stig_results_local }}"
      register: stig_run

    - name: ✅ Print STIG execution result
      ansible.builtin.debug:
        var: stig_run.stdout_lines
