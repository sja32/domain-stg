---
- name: Prepare Hosts for Evaluate-STIG
  hosts: all
  gather_facts: no

  vars:
    stig_share_eval: "\\\\192.168.10.198\\Evaluate-STIG"
    stig_version: "Evaluate-STIG_1.2507.5"
    stig_local_root: "C:\\ProgramData\\Evaluate-STIG_1.2507.5"   # <-- Correct local destination

  tasks:

    - name: ðŸš€ Banner - Start Host Prep
      ansible.builtin.debug:
        msg: "Preparing {{ inventory_hostname }} for Evaluate-STIG"

    - name: Ensure local Evaluate-STIG directory exists
      ansible.windows.win_file:
        path: "{{ stig_local_root }}"
        state: directory

    - name: Copy Evaluate-STIG package from share â†’ local (fresh sync)
      ansible.windows.win_shell: |
        $sec = ConvertTo-SecureString "{{ ansible_password }}" -AsPlainText -Force
        $cred = New-Object System.Management.Automation.PSCredential ("{{ ansible_user }}", $sec)

        # Map share
        New-PSDrive -Name Z -PSProvider FileSystem -Root "{{ stig_share_eval }}" -Credential $cred -ErrorAction Stop | Out-Null

        # Clear existing contents (but not the folder)
        if (Test-Path "{{ stig_local_root }}") {
            Remove-Item "{{ stig_local_root }}\\*" -Recurse -Force -ErrorAction SilentlyContinue
        }

        # Copy new files (no extra nested folder)
        C
