---
- name: Run Evaluate-STIG scan and upload results
  hosts: domain_controllers
  gather_facts: no

  vars:
    stig_workdir: "C:\\ProgramData\\Evaluate-STIG_1.2507.5\\Evaluate-STIG"
    stig_results: "C:\\Users\\Public\\Documents\\STIG_Compliance"
    smb_share_root: "\\\\192.168.10.198\\stig-results"
    smb_user: "voughtnet\\svc-ansible"
    smb_pass: "Luasi965!"

  tasks:

    ###################################################################
    # 1️⃣ Ensure working directory exists
    ###################################################################
    - name: Ensure Evaluate-STIG working directory exists
      ansible.windows.win_file:
        path: "{{ stig_workdir }}"
        state: directory

    ###################################################################
    # 2️⃣ Run Evaluate-STIG scan (Output CKL only)
    ###################################################################
    - name: Run Evaluate-STIG scan
      ansible.windows.win_shell: |
        Write-Host "Running Evaluate-STIG scan..."
        if (-not (Test-Path "{{ stig_workdir }}\\Evaluate-STIG.ps1")) {
            throw "Evaluate-STIG.ps1 not f
