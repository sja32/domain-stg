---
- name: Copy STIG Results to Central Share (Overwrite Mode - No Timestamp)
  hosts: all
  gather_facts: no
  vars:
    # Central file share STIG results root
    stig_results_share: "\\\\fileserver\\STIG-Results"

    # Map survey values â†’ share folder names
    stig_group_folder_map:
      domain_controllers: "Domain-Controllers"
      member_servers: "Member-Servers"
      workstations: "Workstations"

    # Default Evaluate-STIG output location
    stig_local_results_path: "C:\\Users\\Public\\Documents\\STIG-Compliance\\{{ inventory_hostname }}"

  tasks:

    - name: Determine correct group destination folder
      set_fact:
        stig_destination_path: "{{ stig_results_share }}\\{{ stig_group_folder_map[stig_server_group] }}\\{{ inventory_hostname }}"

    - name: Ensure destination folder exists on share
      win_file:
        path: "{{ stig_destination_path }}"
        state: directory

    - name: Copy results to central share (replace existing files)
      win_copy:
        src: "{{ stig_local_results_path }}\\"
        dest: "{{ stig_destination_path }}"
        remote_src: yes

    - name: Confirm copy location
      debug:
        msg: "Results copied to {{ stig_destination_path }}"
